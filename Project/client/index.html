<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>IST Location</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="style/stylesheet.css"/>
</head>
<body>

    <div class="leftPanel">

        <div id="userInfo">
            <h2>User</h2>
            <h4>IST ID: {{ userId }}</h4>
            <h4>Name: {{ userName }}</h4>
        </div>

        <div id="sendLocation">
            <!--<button v-on:click="handleSubmit">Send location</button>-->
            <p>Location has been sent <strong>{{ locationSentCounter }}</strong> times.</p>
            <p>Last time sent: {{ locationSentLast }}</p>
        </div>
        
        <div id="sendRange">
            <form @submit.prevent="handleSubmit">
                <label>
                    <p>Max range (meters):</p>
                    <input type="number" v-model="range">
                    <br>
                </label>
                <button type="submit">Send range</button>
            </form>
        </div>

    </div>

    <div class="middlePanel">

        <h2>Messages</h2>
        <div id="sendMessage">
            <form @submit.prevent="handleSubmit">
                <label>
                    <p>Send a message:</p>
                    <input type="text" v-model="userMessage">
                    <br>
                </label>
                <button type="submit">Send message</button>
            </form>
        </div>

        <div id="getMessages">
            <!--<button v-on:click="getListOfMessages">Get messages</button>-->
            <li v-for="message in messageList">
                <strong>{{message.name}}</strong>: {{ message.content }}
            </li>
        </div>

    </div>

    <div class="rightPanel">

        <div id="getNearbyUsers">
            <!--<button v-on:click="getListOfNearbyUsers">Get nearby users</button>-->
            <h2>Nearby Users</h2>
            <li v-for="user in nearbyUsersList">
                {{ user.id }} - {{ user.userName }}
            </li>
        </div>

    </div>
    
    <!--Axios Import-->
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!--Vue import -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>

    <!-- Local Javascript files import-->
    <script src="js/functions.js"></script>
    <script src="js/main.js"></script>
    <script src="js/authFunctions.js"></script>

    <!-- Add user to DB -->
    <script>//addUserToDB('81356', 'Louren√ßo Pato');</script>
    <script>//console.log(sendGetRequestAxios('https://fenix.tecnico.ulisboa.pt/api/fenix/v1/person'));</script>
    <script>
        var authCode = getAuthCode();
        getTokens(authCode).then(data => {
            var accessToken = data['access_token'];
            var refreshToken = data['refresh_token'];
            console.log(accessToken);
            console.log(refreshToken);
            getUserInfo(accessToken, refreshToken).then(userData => {
                var userName = userData['name'];
                userName = userName.split(' ');
                userName = userName[0] + ' ' + userName[userName.length-1];
                var userId = userData['username'];
                console.log('Username: ' + userName);
                console.log('User id: ' + userId);
            });
        });

    </script>
    
</body>
</html>